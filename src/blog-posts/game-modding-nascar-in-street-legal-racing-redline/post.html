<h3>Introduction</h3>
<p><img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/enjoy-illinois-300.jpg"></img></p>
<p>Yesterday, the NASCAR Cup Series ran its inaugural race on <a href="https://en.wikipedia.org/wiki/Enjoy_Illinois_300">Gateway Motorsports Park</a>.</p>
<p>In honor of this, I decided to revisit an old game, <a href="https://en.wikipedia.org/wiki/Street_Legal_Racing:_Redline">Street Legal Racing: Redline (SLRR)</a>, since it happens to feature the raceway. However, there were a number of changes I needed to make to the game in order to recreate the race myself, so I set out to make my own NASCAR mod!<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/slrr.jpg"></img></p>
<h3>Beginning the Process</h3>
<p>The Steam version of the game features a number of events which take place on actual race tracks rather than on public roads. Of these, a few feature Gateway Raceway, but one in particular stands out as a starting point for recreating yesterday's race: the Gateway Road Endurance event.<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/gateway-road-endurance.png"></img></p>
<p>SLRR doesn't actually feature any NASCAR cars in it, so if you participate in the event without modding the game, the default cars are all DTM race cars:<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/dtm.png"></img>These don't really fit the goal of making a NASCAR-style race. Fortunately, the way that SLRR is packaged makes it incredibly easy to mod. This is likely due to both its age, having been released in 2003, and relatively rushed development leading to a lack of software protections and/or anti-piracy measures.</p>
<h3>Editing Game Code</h3>
<p>Modern games typically only ship with <a href="https://en.wikipedia.org/wiki/Binary_file">compiled binaries</a> but lack any human-readable source code. These compiled binaries consist of low-level machine code designed for fast execution on the end machine, but are extremely difficult for humans to interpret and work with. Shipping with only binaries is beneficial not only because binaries are faster for the machine to run, but also because they are more difficult for humans to interpret and hack/mod the game.</p>
<p>SLRR uses <a href="https://www.java.com/en/">Java</a>, so the source code comes in the form of <i>.java</i> files while the compiled binaries come as <i>.class</i> files. While most games would only ship with the <i>.class</i> files, SLRR actually ships with both types of files included! These script files are relatively easy to find - all you need to do is locate the game's installation folder. As a result, we can edit the human-readable <i>.java</i> file, then delete the corresponding <i>.class</i> file and recompile it for the game to use.<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/code-types.png"></img></p>
<h3>Changing Event Parameters</h3>
<p>Every event in the game has its own corresponding <i>.java</i> and <i>.class</i> files - in this case, we need to edit "GatewayRoadEndurance.java" and recompile "GatewayRoadEndurance.class" to make any changes to the event. These event classes each extend the "CareerEvent" class, which has basic parameters that all events share including game type, racer count, and awards.</p>
<p>In "GatewayRoadEndurance.java", we can find this line which sets a folder path for the vehicles to be used in the race:<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/dtm-path.png"></img></p>
<p>We can change this to any folder path within the game's install directory. I set it to "save/cars/special/NASCAR/". This doesn't exist by default, but I will make the folder later on an populate it with the NASCAR cars - we'll come back to how exactly we can edit the cars.</p>
<p>The second major event parameter I want to change is where the player starts. By default, there are two possibilities: either the player starts the event in first place, or the race starting grid is entirely randomized. I wanted to force the player to start the event in last place so that they would have to work their way through the pack and overtake all of the AI opponents. This was done by editing "Track.java", which includes code for getting the race starting grid. I added a function which reverses the race grid if the corresponding event class requests it: <img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/reverse-grid.png"></img></p>
<p>With these changes in place, we're done editing the game code! Deleting the corresponding <i>.class</i> files and running SLRR causes SLRR to automatically recompile them based on the <i>.java</i> files which we edited. Now, it's time to add the cars which we would like the AI to drive to the cars folder.</p>
<h3>Modifying Cars</h3>
<p>There are plenty of mods out there already for SLRR. For this project, I decided not to actually download any mods myself and to simply use the preexisting cars in the game.</p>
<p>The first step to creating the cars which the AI would use was just to build the car myself in-game as if I were a normal player. For those unfamiliar with SLRR, a major component of the game is the ability to build cars up from scratch - you can purchase individual parts like crankshafts, alternators, pistons, etc. and mix-and-match them into a custom build. Once I had a build that I was satisfied with, I used the built-in "Save Car" functionality to export the car that I had just created:<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/save-car.png"></img><img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/original-build.png"></img></p>
<p>Once a car is exported, we can modify it in external programs. Since this is meant to replicate a NASCAR race, I wanted all of the cars to have identical parts but different paint schemes. Each exported car consists of a variable number of files, but there is a structure to them. The first file is named according to what the player exported the car as and consists of data about the parts used in the car - we won't be editing this one since we want all of the cars to use identical parts. Subsequent files have the same name but with ".#" appended to the end, where "#" is replaced with a number counting up from 1.</p>
<p>These files contain data on the paintjob the car will use, and is what I edited to create more paint schemes. Here is how the file structure looks for a car called "MC NASCAR Petty", which has 20 different textures: <img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/petty-file-structure.png"></img></p>
<p>As it turns out, each of these paint scheme ".#" files is actually just a regular image file in disguise. If we rename a file to a common image format like ".png" or ".jpg", it suddenly becomes an actual image which we can edit:<img src="/media/blog/game-modding-nascar-in-street-legal-racing-redline/petty-png.png"></img></p>
<p>With this in mind, I was able to take these files and edit them in <a href="https://www.gimp.org/">GIMP</a>, a free image-editing program. I created seven total liveries: one for the player and one for each of the six AI opponents. Once I finished editing a texture file, I simply remove the image file extension (in this case, ".png") to revert it back to the form which the game expects.</p>
<p>With the paint schemes created, it's time to place them in the folder which I configured earlier. I simply copy-pasted all of the car files into the "save/special/NASCAR/" directory which I configured in "GatewayRoadEndurance.java".</p>
<h3>The End Result</h3>
<p>After fixing up all crashes and other issues, it was finally time to race! I've recorded the full event, which you can watch below:</p>
<div class="u-16-9">
    <iframe src="https://youtube.com/embed/p04gYb7tF2w?playlist=p04gYb7tF2w&autoplay=0&mute=0&loop=1"/>
</div>